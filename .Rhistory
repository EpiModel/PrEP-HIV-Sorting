length(unique(ARTnet.long$AMIS_ID))
summary(artnet$M_MP12OANUM)
summary(ARTnet.wide$M_MP12OANUM)
table(artnetLong$AMIS_ID)
rm(list = ls())
library("ARTnetData")
artnet <- ARTnet.wide
artnetLong <- ARTnet.long
length(unique(artnetLong$AMIS_ID))
artnet <- ARTnet.wide
artnetLong <- ARTnet.long
#### Egos -----
# Ego Age
artnet$age.cat[artnet$age >= 15 & artnet$age <= 24] <- "15-24"
artnet$age.cat[artnet$age >= 25 & artnet$age <= 34] <- "25-34"
artnet$age.cat[artnet$age >= 35 & artnet$age <= 44] <- "35-44"
artnet$age.cat[artnet$age >= 45 & artnet$age <= 54] <- "45-54"
artnet$age.cat[artnet$age >= 55 & artnet$age <= 65] <- "55-65"
artnet$age.cat[artnet$age > 65] <- "66+"
#### Long Data Set -----
# Partner Age --- using imputed age
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 15 & artnetLong$p_age_imp <= 24] <- "15-24"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 25 & artnetLong$p_age_imp <= 34] <- "25-34"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 35 & artnetLong$p_age_imp <= 44] <- "35-44"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 45 & artnetLong$p_age_imp <= 54] <- "45-54"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 55 & artnetLong$p_age_imp <= 65] <- "55-65"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp > 65] <- "66+"
# Ego Age
artnetLong$age.cat[artnetLong$age >= 15 & artnetLong$age <= 24] <- "15-24"
artnetLong$age.cat[artnetLong$age >= 25 & artnetLong$age <= 34] <- "25-34"
artnetLong$age.cat[artnetLong$age >= 35 & artnetLong$age <= 44] <- "35-44"
artnetLong$age.cat[artnetLong$age >= 45 & artnetLong$age <= 54] <- "45-54"
artnetLong$age.cat[artnetLong$age >= 55 & artnetLong$age <= 65] <- "55-65"
artnetLong$age.cat[artnetLong$age > 65] <- "66+"
# PrEP and HIV for each partner
p1.vars <- select(artnet, AMIS_ID,
ONCE = PART1ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART1PREPUSE,
prep.during.ego.start = PART1PREPSTART,
prep.during.part = PART1PREPUSE_PART,
part_hiv = PART1HIV) %>%
mutate(PARTNER_ID = 1)
p2.vars <- select(artnet, AMIS_ID,
ONCE = PART2ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART2PREPUSE,
prep.during.ego.start = PART2PREPSTART,
prep.during.part = PART2PREPUSE_PART,
part_hiv = PART2HIV) %>%
mutate(PARTNER_ID = 2)
p3.vars <- select(artnet, AMIS_ID,
ONCE = PART3ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART3PREPUSE,
prep.during.ego.start = PART3PREPSTART,
prep.during.part = PART3PREPUSE_PART,
part_hiv = PART3HIV) %>%
mutate(PARTNER_ID = 3)
p4.vars <- select(artnet, AMIS_ID,
ONCE = PART4ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART4PREPUSE,
prep.during.ego.start = PART4PREPSTART,
prep.during.part = PART4PREPUSE_PART,
part_hiv = PART4HIV) %>%
mutate(PARTNER_ID = 4)
p5.vars <- select(artnet, AMIS_ID,
ONCE = PART5ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART5PREPUSE,
prep.during.ego.start = PART5PREPSTART,
prep.during.part = PART5PREPUSE_PART,
part_hiv = PART5HIV) %>%
mutate(PARTNER_ID = 5)
# Combining all of the datasets
pall.vars <- rbind(p1.vars, p2.vars, p3.vars, p4.vars, p5.vars)
# Removing unnecessary objects
rm(p1.vars, p2.vars, p3.vars, p4.vars, p5.vars)
# Dropping observations where ONCE is NA
pall.vars <- pall.vars[which(!is.na(pall.vars$ONCE)),]
# Dropping ONCE from the DF (already in artnetLong)
pall.vars$ONCE <- NULL
# Adding the new partner variables to artnetLong
artnetLong <- inner_join(artnetLong, pall.vars, by = c("AMIS_ID", "PARTNER_ID"))
#### Administrative variable to mark observations for deletion (1 == keep, 0 == remove)
artnetLong$keep <- 1
# Restricting to just anal sex
artnetLong$keep[artnetLong$RAI == 0 & artnetLong$IAI == 0] <- 0
artnetLong <- artnetLong[artnetLong$keep == 1,]
#### Removing n = 947 alters with missing race
artnetLong$keep[which(is.na(artnetLong$p_race.cat))] <- 0
## Egos' PrEP, Ever == 1 & Never == 0 during partnership, 0 for all HIV+ and HIV?
artnetLong$keep[artnetLong$hiv3 == 0 & is.na(artnetLong$prep.ever.ego)] <- 0 # Removing n = 392 egos (N = 1336 partners) where egos were inadvertently not asked about PrEP
artnetLong$keep[artnetLong$prep.ever.ego == 1 & !artnetLong$prep.during.ego%in% c(1,2,3)] <- 0 # Removing 70 partners missing info on prep.during.ego
artnetLong$prep.during.ego2[artnetLong$prep.ever.ego == 0] <- 0 # Never PrEP set to Never During Partnership (was NA)
artnetLong$prep.during.ego2[artnetLong$prep.during.ego == 3] <- 0 # No PrEP during
artnetLong$prep.during.ego2[which(artnetLong$prep.during.ego %in% c(1,2))] <- 1 # Always or Sometimes PrEP
artnetLong$prep.during.ego2[which(artnetLong$hiv3 %in% c(1,2))] <- 0 #All HIV+ and HIV-Unknown are missing PrEP (13 HIV-Unk have used PrEP before but missing for during partnership)
## Partners' HIV
artnetLong$keep[is.na(artnetLong$p_hiv)] <- 0 #Removing 20 with NA p_hiv
artnetLong$keep[artnetLong$part_hiv == 99] <- 0 #Removing 33 with "prefer not to say" for p_hiv
## Partners' PrEP
artnetLong$keep[artnetLong$prep.during.part == 99] <- 0 #Removing 21 with "prefer not to answer"
artnetLong$keep[artnetLong$p_hiv %in% c(0,2) & is.na(artnetLong$prep.during.part)] <- 0 #Removing 6 with NA PrEP
artnetLong$prep.during.part2[artnetLong$prep.during.part == 88] <- 2 # I don't know
artnetLong$prep.during.part2[artnetLong$prep.during.part == 3] <- 0 # No PrEP during
artnetLong$prep.during.part2[which(artnetLong$prep.during.part %in% c(1,2))] <- 1 # Always or Sometimes PrEP
artnetLong$prep.during.part2[artnetLong$p_hiv == 1] <- 0 # Set all HIV+ to No PrEP
## Removing all of the observations marked for deletion
artnetLong <- artnetLong[artnetLong$keep == 1,]
table(ARTnet.wide$MSMP12M_NONE, useNA = "ifany")
table(ARTnet.wide$MSMP12M_NONE, ARTnet.wide$MSMP12M_ANAL, useNA = "ifany")
table(ARTnet.wide$MSMP12M_NONE, ARTnet.wide$MSMP12M_ORAL, useNA = "ifany")
table(ARTnet.wide$MSMP12M_OTHER, ARTnet.wide$MSMP12M_ORAL, useNA = "ifany")
table(ARTnet.wide$MSMP12M_NONE, ARTnet.wide$MSMP12M_OTHER, useNA = "ifany")
table(ARTnet.wide$MSMP12M_NONE, ARTnet.wide$MSMP12M_REFUSE, useNA = "ifany")
length(unique(ARTnet.long$AMIS_ID))
artnet <- ARTnet.wide
artnetLong <- ARTnet.long
#### Egos -----
# Ego Age
artnet$age.cat[artnet$age >= 15 & artnet$age <= 24] <- "15-24"
artnet$age.cat[artnet$age >= 25 & artnet$age <= 34] <- "25-34"
artnet$age.cat[artnet$age >= 35 & artnet$age <= 44] <- "35-44"
artnet$age.cat[artnet$age >= 45 & artnet$age <= 54] <- "45-54"
artnet$age.cat[artnet$age >= 55 & artnet$age <= 65] <- "55-65"
artnet$age.cat[artnet$age > 65] <- "66+"
#### Long Data Set -----
# Partner Age --- using imputed age
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 15 & artnetLong$p_age_imp <= 24] <- "15-24"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 25 & artnetLong$p_age_imp <= 34] <- "25-34"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 35 & artnetLong$p_age_imp <= 44] <- "35-44"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 45 & artnetLong$p_age_imp <= 54] <- "45-54"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 55 & artnetLong$p_age_imp <= 65] <- "55-65"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp > 65] <- "66+"
# Ego Age
artnetLong$age.cat[artnetLong$age >= 15 & artnetLong$age <= 24] <- "15-24"
artnetLong$age.cat[artnetLong$age >= 25 & artnetLong$age <= 34] <- "25-34"
artnetLong$age.cat[artnetLong$age >= 35 & artnetLong$age <= 44] <- "35-44"
artnetLong$age.cat[artnetLong$age >= 45 & artnetLong$age <= 54] <- "45-54"
artnetLong$age.cat[artnetLong$age >= 55 & artnetLong$age <= 65] <- "55-65"
artnetLong$age.cat[artnetLong$age > 65] <- "66+"
# PrEP and HIV for each partner
p1.vars <- select(artnet, AMIS_ID,
ONCE = PART1ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART1PREPUSE,
prep.during.ego.start = PART1PREPSTART,
prep.during.part = PART1PREPUSE_PART,
part_hiv = PART1HIV) %>%
mutate(PARTNER_ID = 1)
p2.vars <- select(artnet, AMIS_ID,
ONCE = PART2ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART2PREPUSE,
prep.during.ego.start = PART2PREPSTART,
prep.during.part = PART2PREPUSE_PART,
part_hiv = PART2HIV) %>%
mutate(PARTNER_ID = 2)
p3.vars <- select(artnet, AMIS_ID,
ONCE = PART3ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART3PREPUSE,
prep.during.ego.start = PART3PREPSTART,
prep.during.part = PART3PREPUSE_PART,
part_hiv = PART3HIV) %>%
mutate(PARTNER_ID = 3)
p4.vars <- select(artnet, AMIS_ID,
ONCE = PART4ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART4PREPUSE,
prep.during.ego.start = PART4PREPSTART,
prep.during.part = PART4PREPUSE_PART,
part_hiv = PART4HIV) %>%
mutate(PARTNER_ID = 4)
p5.vars <- select(artnet, AMIS_ID,
ONCE = PART5ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART5PREPUSE,
prep.during.ego.start = PART5PREPSTART,
prep.during.part = PART5PREPUSE_PART,
part_hiv = PART5HIV) %>%
mutate(PARTNER_ID = 5)
# Combining all of the datasets
pall.vars <- rbind(p1.vars, p2.vars, p3.vars, p4.vars, p5.vars)
# Removing unnecessary objects
rm(p1.vars, p2.vars, p3.vars, p4.vars, p5.vars)
# Dropping observations where ONCE is NA
pall.vars <- pall.vars[which(!is.na(pall.vars$ONCE)),]
# Dropping ONCE from the DF (already in artnetLong)
pall.vars$ONCE <- NULL
# Adding the new partner variables to artnetLong
artnetLong <- inner_join(artnetLong, pall.vars, by = c("AMIS_ID", "PARTNER_ID"))
#### Administrative variable to mark observations for deletion (1 == keep, 0 == remove)
artnetLong$keep <- 1
# Restricting to just anal sex
artnetLong$keep[artnetLong$RAI == 0 & artnetLong$IAI == 0] <- 0
artnetLong <- artnetLong[artnetLong$keep == 1,]
length(unique(artnetLong$AMIS_ID))
table(artnetLong$p_race.cat, useNA = "ifany")
table(artnetLong$part_hiv, useNA = "ifany")
table(artnet$EVERTEST, useNA = "ifany")
View(artnetLong)
table(artnet$EVERTEST, artnet$hiv3, useNA = "ifany")
table(artnetLong$keep)
## Egos' PrEP, Ever == 1 & Never == 0 during partnership, 0 for all HIV+ and HIV?
artnetLong$keep[artnetLong$hiv3 == 0 & is.na(artnetLong$prep.ever.ego)] <- 0 # Removing if egos were inadvertently not asked about PrEP
table(artnetLong$keep)
length(unique(artnetLong$AMIS_ID[artnetLong$keep == 0]))
artnetLong <- artnetLong[artnetLong$keep == 1,]
table(artnetLong$keep)
artnetLong$keep[artnetLong$prep.ever.ego == 1 & !artnetLong$prep.during.ego%in% c(1,2,3)] <- 0 # Removing if missing info on prep.during.ego
table(artnetLong$keep)
table(artnetLong$prep.ever.ego, artnetLong$prep.during.ego, useNA = "ifany")
artnet <- ARTnet.wide
artnetLong <- ARTnet.long
#### Egos -----
# Ego Age
artnet$age.cat[artnet$age >= 15 & artnet$age <= 24] <- "15-24"
artnet$age.cat[artnet$age >= 25 & artnet$age <= 34] <- "25-34"
artnet$age.cat[artnet$age >= 35 & artnet$age <= 44] <- "35-44"
artnet$age.cat[artnet$age >= 45 & artnet$age <= 54] <- "45-54"
artnet$age.cat[artnet$age >= 55 & artnet$age <= 65] <- "55-65"
artnet$age.cat[artnet$age > 65] <- "66+"
#### Long Data Set -----
# Partner Age --- using imputed age
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 15 & artnetLong$p_age_imp <= 24] <- "15-24"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 25 & artnetLong$p_age_imp <= 34] <- "25-34"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 35 & artnetLong$p_age_imp <= 44] <- "35-44"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 45 & artnetLong$p_age_imp <= 54] <- "45-54"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 55 & artnetLong$p_age_imp <= 65] <- "55-65"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp > 65] <- "66+"
# Ego Age
artnetLong$age.cat[artnetLong$age >= 15 & artnetLong$age <= 24] <- "15-24"
artnetLong$age.cat[artnetLong$age >= 25 & artnetLong$age <= 34] <- "25-34"
artnetLong$age.cat[artnetLong$age >= 35 & artnetLong$age <= 44] <- "35-44"
artnetLong$age.cat[artnetLong$age >= 45 & artnetLong$age <= 54] <- "45-54"
artnetLong$age.cat[artnetLong$age >= 55 & artnetLong$age <= 65] <- "55-65"
artnetLong$age.cat[artnetLong$age > 65] <- "66+"
# PrEP and HIV for each partner
p1.vars <- select(artnet, AMIS_ID,
ONCE = PART1ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART1PREPUSE,
prep.during.ego.start = PART1PREPSTART,
prep.during.part = PART1PREPUSE_PART,
part_hiv = PART1HIV) %>%
mutate(PARTNER_ID = 1)
p2.vars <- select(artnet, AMIS_ID,
ONCE = PART2ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART2PREPUSE,
prep.during.ego.start = PART2PREPSTART,
prep.during.part = PART2PREPUSE_PART,
part_hiv = PART2HIV) %>%
mutate(PARTNER_ID = 2)
p3.vars <- select(artnet, AMIS_ID,
ONCE = PART3ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART3PREPUSE,
prep.during.ego.start = PART3PREPSTART,
prep.during.part = PART3PREPUSE_PART,
part_hiv = PART3HIV) %>%
mutate(PARTNER_ID = 3)
p4.vars <- select(artnet, AMIS_ID,
ONCE = PART4ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART4PREPUSE,
prep.during.ego.start = PART4PREPSTART,
prep.during.part = PART4PREPUSE_PART,
part_hiv = PART4HIV) %>%
mutate(PARTNER_ID = 4)
p5.vars <- select(artnet, AMIS_ID,
ONCE = PART5ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART5PREPUSE,
prep.during.ego.start = PART5PREPSTART,
prep.during.part = PART5PREPUSE_PART,
part_hiv = PART5HIV) %>%
mutate(PARTNER_ID = 5)
# Combining all of the datasets
pall.vars <- rbind(p1.vars, p2.vars, p3.vars, p4.vars, p5.vars)
# Dropping observations where ONCE is NA
pall.vars <- pall.vars[which(!is.na(pall.vars$ONCE)),]
# Dropping ONCE from the DF (already in artnetLong)
pall.vars$ONCE <- NULL
# Adding the new partner variables to artnetLong
artnetLong <- inner_join(artnetLong, pall.vars, by = c("AMIS_ID", "PARTNER_ID"))
# Removing unnecessary objects
rm(p1.vars, p2.vars, p3.vars, p4.vars, p5.vars, pall.vars)
#### Administrative variable to mark observations for deletion (1 == keep, 0 == remove)
artnetLong$keep <- 1
# Restricting to just anal sex
artnetLong$keep[artnetLong$RAI == 0 & artnetLong$IAI == 0] <- 0
artnetLong <- artnetLong[artnetLong$keep == 1,]
table(artnetLong$keep)
table(artnetLong$p_hiv, useNA = "ifany")
artnetLong$keep[is.na(artnetLong$p_hiv)] <- 0 #Removing if p_hiv == NA
artnetLong$keep[artnetLong$part_hiv == 99] <- 0 #Removing if "prefer not to say" for p_hiv
artnetLong <- artnetLong[artnetLong$keep == 1,]
table(artnetLong$prep.during.part, artnetLong$p_hiv, useNA = "ifany")
artnet <- ARTnet.wide
artnetLong <- ARTnet.long
#### Egos -----
# Ego Age
artnet$age.cat[artnet$age >= 15 & artnet$age <= 24] <- "15-24"
artnet$age.cat[artnet$age >= 25 & artnet$age <= 34] <- "25-34"
artnet$age.cat[artnet$age >= 35 & artnet$age <= 44] <- "35-44"
artnet$age.cat[artnet$age >= 45 & artnet$age <= 54] <- "45-54"
artnet$age.cat[artnet$age >= 55 & artnet$age <= 65] <- "55-65"
artnet$age.cat[artnet$age > 65] <- "66+"
#### Long Data Set -----
# Partner Age --- using imputed age
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 15 & artnetLong$p_age_imp <= 24] <- "15-24"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 25 & artnetLong$p_age_imp <= 34] <- "25-34"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 35 & artnetLong$p_age_imp <= 44] <- "35-44"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 45 & artnetLong$p_age_imp <= 54] <- "45-54"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp >= 55 & artnetLong$p_age_imp <= 65] <- "55-65"
artnetLong$p_age.cat_imp[artnetLong$p_age_imp > 65] <- "66+"
# Ego Age
artnetLong$age.cat[artnetLong$age >= 15 & artnetLong$age <= 24] <- "15-24"
artnetLong$age.cat[artnetLong$age >= 25 & artnetLong$age <= 34] <- "25-34"
artnetLong$age.cat[artnetLong$age >= 35 & artnetLong$age <= 44] <- "35-44"
artnetLong$age.cat[artnetLong$age >= 45 & artnetLong$age <= 54] <- "45-54"
artnetLong$age.cat[artnetLong$age >= 55 & artnetLong$age <= 65] <- "55-65"
artnetLong$age.cat[artnetLong$age > 65] <- "66+"
# PrEP and HIV for each partner
p1.vars <- select(artnet, AMIS_ID,
ONCE = PART1ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART1PREPUSE,
prep.during.ego.start = PART1PREPSTART,
prep.during.part = PART1PREPUSE_PART,
part_hiv = PART1HIV) %>%
mutate(PARTNER_ID = 1)
p2.vars <- select(artnet, AMIS_ID,
ONCE = PART2ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART2PREPUSE,
prep.during.ego.start = PART2PREPSTART,
prep.during.part = PART2PREPUSE_PART,
part_hiv = PART2HIV) %>%
mutate(PARTNER_ID = 2)
p3.vars <- select(artnet, AMIS_ID,
ONCE = PART3ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART3PREPUSE,
prep.during.ego.start = PART3PREPSTART,
prep.during.part = PART3PREPUSE_PART,
part_hiv = PART3HIV) %>%
mutate(PARTNER_ID = 3)
p4.vars <- select(artnet, AMIS_ID,
ONCE = PART4ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART4PREPUSE,
prep.during.ego.start = PART4PREPSTART,
prep.during.part = PART4PREPUSE_PART,
part_hiv = PART4HIV) %>%
mutate(PARTNER_ID = 4)
p5.vars <- select(artnet, AMIS_ID,
ONCE = PART5ONCE,
prep.ever.ego = PREP_REVISED,
prep.during.ego = PART5PREPUSE,
prep.during.ego.start = PART5PREPSTART,
prep.during.part = PART5PREPUSE_PART,
part_hiv = PART5HIV) %>%
mutate(PARTNER_ID = 5)
# Combining all of the datasets
pall.vars <- rbind(p1.vars, p2.vars, p3.vars, p4.vars, p5.vars)
# Dropping observations where ONCE is NA
pall.vars <- pall.vars[which(!is.na(pall.vars$ONCE)),]
# Dropping ONCE from the DF (already in artnetLong)
pall.vars$ONCE <- NULL
# Adding the new partner variables to artnetLong
artnetLong <- inner_join(artnetLong, pall.vars, by = c("AMIS_ID", "PARTNER_ID"))
# Removing unnecessary objects
rm(p1.vars, p2.vars, p3.vars, p4.vars, p5.vars, pall.vars)
#### Administrative variable to mark observations for deletion (1 == keep, 0 == remove)
artnetLong$keep <- 1
# Restricting to just anal sex
artnetLong$keep[artnetLong$RAI == 0 & artnetLong$IAI == 0] <- 0
artnetLong <- artnetLong[artnetLong$keep == 1,]
#### Removing missing race
artnetLong$keep[which(is.na(artnetLong$p_race.cat))] <- 0
## Egos' PrEP, Ever == 1 & Never == 0 during partnership, 0 for all HIV+ and HIV?
artnetLong$keep[artnetLong$hiv3 == 0 & is.na(artnetLong$prep.ever.ego)] <- 0 # Egos were inadvertently not asked about PrEP
artnetLong$keep[artnetLong$prep.ever.ego == 1 & !artnetLong$prep.during.ego%in% c(1,2,3)] <- 0 # Missing info on prep.during.ego
artnetLong$prep.during.ego2[artnetLong$prep.ever.ego == 0] <- 0 # Never PrEP set to Never During Partnership (was NA)
artnetLong$prep.during.ego2[artnetLong$prep.during.ego == 3] <- 0 # No PrEP during
artnetLong$prep.during.ego2[which(artnetLong$prep.during.ego %in% c(1,2))] <- 1 # Always or Sometimes PrEP
artnetLong$prep.during.ego2[which(artnetLong$hiv3 %in% c(1,2))] <- 0 #All HIV+ and HIV-Unknown are missing PrEP
## Partners' HIV
artnetLong$keep[is.na(artnetLong$p_hiv)] <- 0 # p_hiv == NA
artnetLong$keep[artnetLong$part_hiv == 99] <- 0 # "prefer not to say" for part_hiv
## Partners' PrEP
artnetLong$keep[artnetLong$prep.during.part == 99] <- 0 #"prefer not to answer"
artnetLong$keep[artnetLong$p_hiv %in% c(0,2) & is.na(artnetLong$prep.during.part)] <- 0 #prep.during.part == NA
artnetLong$prep.during.part2[artnetLong$prep.during.part == 88] <- 2 # I don't know
artnetLong$prep.during.part2[artnetLong$prep.during.part == 3] <- 0 # No PrEP during
artnetLong$prep.during.part2[which(artnetLong$prep.during.part %in% c(1,2))] <- 1 # Always or Sometimes PrEP
artnetLong$prep.during.part2[artnetLong$p_hiv == 1] <- 0 # Set all HIV+ to No PrEP
## Removing all of the observations marked for deletion
artnetLong <- artnetLong[artnetLong$keep == 1,]
length(unique(artnetLong$AMIS_ID))
#### Dyads for tables ----
#HIV mixing
artnetLong$d_hiv[artnetLong$hiv3 == 0 & artnetLong$p_hiv == 0] <- "NEGNEG"
artnetLong$d_hiv[artnetLong$hiv3 == 0 & artnetLong$p_hiv == 1] <- "NEGPOS"
artnetLong$d_hiv[artnetLong$hiv3 == 0 & artnetLong$p_hiv == 2] <- "NEGUNK"
artnetLong$d_hiv[artnetLong$hiv3 == 1 & artnetLong$p_hiv == 0] <- "POSNEG"
artnetLong$d_hiv[artnetLong$hiv3 == 1 & artnetLong$p_hiv == 1] <- "POSPOS"
artnetLong$d_hiv[artnetLong$hiv3 == 1 & artnetLong$p_hiv == 2] <- "POSUNK"
artnetLong$d_hiv[artnetLong$hiv3 == 2 & artnetLong$p_hiv == 0] <- "UNKNEG"
artnetLong$d_hiv[artnetLong$hiv3 == 2 & artnetLong$p_hiv == 1] <- "UNKPOS"
artnetLong$d_hiv[artnetLong$hiv3 == 2 & artnetLong$p_hiv == 2] <- "UNKUNK"
### PREP & HIV mixing ###
## Ego == (-) no PrEP
# Partner == (-) no PrEP
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 0 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 0] <- "NOP-NOP"
# Partner == (-) PrEP
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 0 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 1] <- "NOP-YEP"
# Partner == (-) PrEP UNK
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 0 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 2] <- "NOP-PUK"
# Partner == (+)
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 0 &
artnetLong$p_hiv == 1] <- "NOP-POS"
# Partner == (?)
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 0 &
artnetLong$p_hiv == 2] <- "NOP-UNK"
## Ego == (-) PrEP
# Partner == (-) no PrEP
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 1 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 0] <- "YEP-NOP"
# Partner == (-) PrEP
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 1 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 1] <- "YEP-YEP"
# Partner == (-) PrEP UNK
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 1 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 2] <- "YEP-PUK"
# Partner == (+)
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 1 &
artnetLong$p_hiv == 1] <- "YEP-POS"
# Partner == (?)
artnetLong$d_hivprep[artnetLong$hiv3 == 0 &
artnetLong$prep.during.ego2 == 1 &
artnetLong$p_hiv == 2] <- "YEP-UNK"
## Ego == (+)
# Partner == (-) no PrEP
artnetLong$d_hivprep[artnetLong$hiv3 == 1 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 0] <- "POS-NOP"
# Partner == (-) PrEP
artnetLong$d_hivprep[artnetLong$hiv3 == 1 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 1] <- "POS-YEP"
# Partner == (-) PrEP UNK
artnetLong$d_hivprep[artnetLong$hiv3 == 1 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 2] <- "POS-PUK"
# Partner == (+)
artnetLong$d_hivprep[artnetLong$hiv3 == 1 &
artnetLong$p_hiv == 1] <- "POS-POS"
# Partner == (?)
artnetLong$d_hivprep[artnetLong$hiv3 == 1 &
artnetLong$p_hiv == 2] <- "POS-UNK"
## Ego == (?)
# Partner == (-) no PrEP
artnetLong$d_hivprep[artnetLong$hiv3 == 2 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 0] <- "UNK-NOP"
# Partner == (-) PrEP
artnetLong$d_hivprep[artnetLong$hiv3 == 2 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 1] <- "UNK-YEP"
# Partner == (-) PrEP UNK
artnetLong$d_hivprep[artnetLong$hiv3 == 2 &
artnetLong$p_hiv == 0 &
artnetLong$prep.during.part2 == 2] <- "UNK-PUK"
# Partner == (+)
artnetLong$d_hivprep[artnetLong$hiv3 == 2 &
artnetLong$p_hiv == 1] <- "UNK-POS"
# Partner == (?)
artnetLong$d_hivprep[artnetLong$hiv3 == 2 &
artnetLong$p_hiv == 2] <- "UNK-UNK"
table(artnetLong$prep.during.ego2, useNA = "ifany")
table(artnetLong$hiv3)
prop.table(table(artnetLong$hiv3))
prop.table(table(artnetLong$p_hiv, useNA = "ifany"))
prop.table(table(artnetLong$prep.during.ego2, useNA = "ifany"))
prop.table(table(artnetLong$prep.during.part2, useNA = "ifany"))
prop.table(table(artnetLong$hiv3, artnetLong$p_hiv, useNA = "ifany"))
prop.table(table(artnetLong$hiv3, artnetLong$p_hiv, useNA = "ifany"),1)
table(artnetLong$hiv3, artnetLong$p_hiv, useNA = "ifany")
