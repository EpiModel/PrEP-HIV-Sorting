reclass[[i]]$sens.hiv.total <- mean(dfs[[i]]$sens.xr.hiv)
reclass[[i]]$sens.hiv.age <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$sens.hiv.race <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$sens.hiv.er <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$sens.hiv.ptype <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$sens.hiv.main <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$sens.hiv.casual <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$sens.hiv.once <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Spec(x,r) for HIV
reclass[[i]]$spec.hiv.total <- mean(dfs[[i]]$spec.xr.hiv)
reclass[[i]]$spec.hiv.age <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$spec.hiv.race <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$spec.hiv.er <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$spec.hiv.ptype <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$spec.hiv.main <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$spec.hiv.casual <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$spec.hiv.once <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# P(y=1) for HIV
reclass[[i]]$pred.hiv.total <- mean(dfs[[i]]$pred.hiv)
reclass[[i]]$pred.hiv.age <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$pred.hiv.race <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$pred.hiv.er <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$pred.hiv.ptype <- by(dfs[[i]]$pred.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$pred.hiv.main <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$pred.hiv.casual <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$pred.hiv.once <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Prevalence of imputed HIV
reclass[[i]]$imp.hiv.total <- mean(dfs[[i]]$p_hiv.imp)
reclass[[i]]$imp.hiv.age <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$imp.hiv.race <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$imp.hiv.er <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_hiv, mean)
reclass[[i]]$imp.hiv.ptype <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$ptype, mean)
reclass[[i]]$imp.hiv.main <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$imp.hiv.casual <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$imp.hiv.once <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
### PrEP reclassification ----
# P(y*=1) for PrEP
reclass[[i]]$star1.prep.total <- mean(dfs[[i]]$star1.prep)
reclass[[i]]$star1.prep.age <- by(dfs[[i]]$star1.prep, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$star1.prep.race <- by(dfs[[i]]$star1.prep, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$star1.prep.er <- by(dfs[[i]]$star1.prep, dfs[[i]]$prep.during.part2, mean)
reclass[[i]]$star1.prep.ptype <- by(dfs[[i]]$star1.prep, dfs[[i]]$ptype, mean)
reclass[[i]]$star1.prep.main <- by(dfs[[i]]$star1.prep[dfs[[i]]$ptype == "Main"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$star1.prep.casual <- by(dfs[[i]]$star1.prep[dfs[[i]]$ptype == "Casual"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$star1.prep.once <- by(dfs[[i]]$star1.prep[dfs[[i]]$ptype == "Once"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Once"], mean)
# Sens(x,r) for PrEP
reclass[[i]]$sens.prep.total <- mean(dfs[[i]]$sens.xr.prep)
reclass[[i]]$sens.prep.age <- by(dfs[[i]]$sens.xr.prep, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$sens.prep.race <- by(dfs[[i]]$sens.xr.prep, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$sens.prep.er <- by(dfs[[i]]$sens.xr.prep, dfs[[i]]$prep.during.part2, mean)
reclass[[i]]$sens.prep.ptype <- by(dfs[[i]]$sens.xr.prep, dfs[[i]]$ptype, mean)
reclass[[i]]$sens.prep.main <- by(dfs[[i]]$sens.xr.prep[dfs[[i]]$ptype == "Main"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$sens.prep.casual <- by(dfs[[i]]$sens.xr.prep[dfs[[i]]$ptype == "Casual"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$sens.prep.once <- by(dfs[[i]]$sens.xr.prep[dfs[[i]]$ptype == "Once"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Once"], mean)
# Spec(x,r) for PrEP
reclass[[i]]$spec.prep.total <- mean(dfs[[i]]$spec.xr.prep)
reclass[[i]]$spec.prep.age <- by(dfs[[i]]$spec.xr.prep, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$spec.prep.race <- by(dfs[[i]]$spec.xr.prep, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$spec.prep.er <- by(dfs[[i]]$spec.xr.prep, dfs[[i]]$prep.during.part2, mean)
reclass[[i]]$spec.prep.ptype <- by(dfs[[i]]$spec.xr.prep, dfs[[i]]$ptype, mean)
reclass[[i]]$spec.prep.main <- by(dfs[[i]]$spec.xr.prep[dfs[[i]]$ptype == "Main"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$spec.prep.casual <- by(dfs[[i]]$spec.xr.prep[dfs[[i]]$ptype == "Casual"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$spec.prep.once <- by(dfs[[i]]$spec.xr.prep[dfs[[i]]$ptype == "Once"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Once"], mean)
# P(y=1) for PrEP
reclass[[i]]$pred.prep.total <- mean(dfs[[i]]$pred.prep)
reclass[[i]]$pred.prep.age <- by(dfs[[i]]$pred.prep, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$pred.prep.race <- by(dfs[[i]]$pred.prep, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$pred.prep.er <- by(dfs[[i]]$pred.prep, dfs[[i]]$prep.during.part2, mean)
reclass[[i]]$pred.prep.ptype <- by(dfs[[i]]$pred.prep, dfs[[i]]$ptype, mean)
reclass[[i]]$pred.prep.main <- by(dfs[[i]]$pred.prep[dfs[[i]]$ptype == "Main"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$pred.prep.casual <- by(dfs[[i]]$pred.prep[dfs[[i]]$ptype == "Casual"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$pred.prep.once <- by(dfs[[i]]$pred.prep[dfs[[i]]$ptype == "Once"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Once"], mean)
# Prevalence of imputed PrEP
reclass[[i]]$imp.prep.total <- mean(dfs[[i]]$prep.imp)
reclass[[i]]$imp.prep.age <- by(dfs[[i]]$prep.imp, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$imp.prep.race <- by(dfs[[i]]$prep.imp, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$imp.prep.er <- by(dfs[[i]]$prep.imp, dfs[[i]]$prep.during.part2, mean)
reclass[[i]]$imp.prep.ptype <- by(dfs[[i]]$prep.imp, dfs[[i]]$ptype, mean)
reclass[[i]]$imp.prep.main <- by(dfs[[i]]$prep.imp[dfs[[i]]$ptype == "Main"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$imp.prep.casual <- by(dfs[[i]]$prep.imp[dfs[[i]]$ptype == "Casual"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$imp.prep.once <- by(dfs[[i]]$prep.imp[dfs[[i]]$ptype == "Once"], dfs[[i]]$prep.during.part2[dfs[[i]]$ptype == "Once"], mean)
}
listVec <- lapply(reclass, c, recursive=TRUE)
reclass.results <- as.data.frame(do.call(rbind, listVec))
results <- function(dat, x) {
q <- select(dat, starts_with(x))
#return(t(apply(q, 2, quantile, probs = c(0.025, 0.5, 0.975), na.rm = FALSE)))
#return(t(apply(q, 2, quantile, probs = c(0, 0.5, 1), na.rm = FALSE)))
return(t(apply(q, 2, median, na.rm = FALSE)))
}
results(dat = reclass.results, x = "star1.prep")
# Summary data for each dataset
reclass <- vector("list", 300)
for (i in seq_along(1:300)) {
### HIV reclassification ----
# P(y*=1) for HIV
reclass[[i]]$star1.hiv.total <- mean(dfs[[i]]$star1.hiv)
reclass[[i]]$star1.hiv.age <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$star1.hiv.race <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$star1.hiv.er <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$star1.hiv.ptype <- by(dfs[[i]]$star1.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$star1.hiv.main <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$star1.hiv.casual <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$star1.hiv.once <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Sens(x,r) for HIV
reclass[[i]]$sens.hiv.total <- mean(dfs[[i]]$sens.xr.hiv)
reclass[[i]]$sens.hiv.age <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$sens.hiv.race <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$sens.hiv.er <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$sens.hiv.ptype <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$sens.hiv.main <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$sens.hiv.casual <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$sens.hiv.once <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Spec(x,r) for HIV
reclass[[i]]$spec.hiv.total <- mean(dfs[[i]]$spec.xr.hiv)
reclass[[i]]$spec.hiv.age <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$spec.hiv.race <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$spec.hiv.er <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$spec.hiv.ptype <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$spec.hiv.main <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$spec.hiv.casual <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$spec.hiv.once <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# P(y=1) for HIV
reclass[[i]]$pred.hiv.total <- mean(dfs[[i]]$pred.hiv)
reclass[[i]]$pred.hiv.age <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$pred.hiv.race <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$pred.hiv.er <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$pred.hiv.ptype <- by(dfs[[i]]$pred.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$pred.hiv.main <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$pred.hiv.casual <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$pred.hiv.once <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Prevalence of imputed HIV
reclass[[i]]$imp.hiv.total <- mean(dfs[[i]]$p_hiv.imp)
reclass[[i]]$imp.hiv.age <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$imp.hiv.race <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$imp.hiv.er <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_hiv, mean)
reclass[[i]]$imp.hiv.ptype <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$ptype, mean)
reclass[[i]]$imp.hiv.main <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$imp.hiv.casual <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$imp.hiv.once <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
### PrEP reclassification ----
# Subset of alters imputed without diagnosed HIV
dfs2[[i]] <- dfs[[i]] %>% filter(p_hiv.imp == 0)
# P(y*=1) for PrEP
reclass[[i]]$star1.prep.total <- mean(dfs2[[i]]$star1.prep)
reclass[[i]]$star1.prep.age <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$star1.prep.race <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$star1.prep.er <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$star1.prep.ptype <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$star1.prep.main <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$star1.prep.casual <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$star1.prep.once <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# Sens(x,r) for PrEP
reclass[[i]]$sens.prep.total <- mean(dfs2[[i]]$sens.xr.prep)
reclass[[i]]$sens.prep.age <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$sens.prep.race <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$sens.prep.er <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$sens.prep.ptype <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$sens.prep.main <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$sens.prep.casual <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$sens.prep.once <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# Spec(x,r) for PrEP
reclass[[i]]$spec.prep.total <- mean(dfs2[[i]]$spec.xr.prep)
reclass[[i]]$spec.prep.age <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$spec.prep.race <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$spec.prep.er <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$spec.prep.ptype <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$spec.prep.main <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$spec.prep.casual <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$spec.prep.once <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# P(y=1) for PrEP
reclass[[i]]$pred.prep.total <- mean(dfs2[[i]]$pred.prep)
reclass[[i]]$pred.prep.age <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$pred.prep.race <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$pred.prep.er <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$pred.prep.ptype <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$pred.prep.main <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$pred.prep.casual <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$pred.prep.once <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# Prevalence of imputed PrEP
reclass[[i]]$imp.prep.total <- mean(dfs2[[i]]$prep.imp)
reclass[[i]]$imp.prep.age <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$imp.prep.race <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$imp.prep.er <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$imp.prep.ptype <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$ptype, mean)
reclass[[i]]$imp.prep.main <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$imp.prep.casual <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$imp.prep.once <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
}
dfs2 <- vector("list", 300)
for (i in seq_along(1:300)) {
# HIV prevalence
reclass[[i]]$hiv.imp.n <- table(dfs[[i]]$p_hiv.imp)
reclass[[i]]$hiv.imp.p <- prop.table(table(dfs[[i]]$p_hiv.imp))
# HIV reclassification
reclass[[i]]$hiv.reclass.n <- table(dfs[[i]]$p_hiv, dfs[[i]]$p_hiv.imp)
reclass[[i]]$hiv.reclass.p <- prop.table(table(dfs[[i]]$p_hiv, dfs[[i]]$p_hiv.imp), 1)
# HIV-HIV sorting
reclass[[i]]$hh.sort.n <- table(dfs[[i]]$hiv2, dfs[[i]]$p_hiv.imp)
reclass[[i]]$hh.sort.p <- prop.table(table(dfs[[i]]$hiv2, dfs[[i]]$p_hiv.imp), 1)
# PrEP prevalence, given neg/unk
reclass[[i]]$prep.imp.n <- table(dfs[[i]]$prep.imp)
reclass[[i]]$prep.imp.p <- prop.table(table(dfs[[i]]$prep.imp))
# PrEP reclassification
reclass[[i]]$prep.reclass.n <- table(dfs[[i]]$prep.during.part2, dfs[[i]]$prep.imp)
reclass[[i]]$prep.reclass.p <- prop.table(table(dfs[[i]]$prep.during.part2, dfs[[i]]$prep.imp), 1)
# HIV prevalence among egos, given partner is HIV -/?
reclass[[i]]$ehiv.pneg.n <- table(dfs[[i]]$hiv2[dfs[[i]]$p_hiv.imp == 0])
reclass[[i]]$ehiv.pneg.p <- prop.table(table(dfs[[i]]$hiv2[dfs[[i]]$p_hiv.imp == 0]))
# HIV-PrEP sorting (ego's HIV, partner's imputed PrEP)
reclass[[i]]$hp.sort.n <- table(dfs[[i]]$hiv2, dfs[[i]]$prep.imp)
reclass[[i]]$hp.sort.p <- prop.table(table(dfs[[i]]$hiv2, dfs[[i]]$prep.imp),1)
# PrEP prevalence among egos, given partner is HIV -/?
reclass[[i]]$eprep.pneg.n <- table(dfs[[i]]$prep.during.ego2[dfs[[i]]$p_hiv.imp == 0 & dfs[[i]]$hiv2 == 0])
reclass[[i]]$eprep.pneg.p <- prop.table(table(dfs[[i]]$prep.during.ego2[dfs[[i]]$p_hiv.imp == 0 & dfs[[i]]$hiv2 == 0]))
# PrEP-PrEP sorting
reclass[[i]]$pp.sort.n <- table(dfs[[i]]$prep.during.ego2[dfs[[i]]$hiv2 == 0], dfs[[i]]$prep.imp[dfs[[i]]$hiv2 == 0])
reclass[[i]]$pp.sort.p <- prop.table(table(dfs[[i]]$prep.during.ego2[dfs[[i]]$hiv2 == 0], dfs[[i]]$prep.imp[dfs[[i]]$hiv2 == 0]), 1)
# PrEP-HIV sorting (ego's PrEP, partner's imputed HIV)
reclass[[i]]$ph.sort.n <- table(dfs[[i]]$prep.during.ego2[dfs[[i]]$hiv2 == 0], dfs[[i]]$p_hiv.imp[dfs[[i]]$hiv2 == 0])
reclass[[i]]$ph.sort.p <- prop.table(table(dfs[[i]]$prep.during.ego2[dfs[[i]]$hiv2 == 0], dfs[[i]]$p_hiv.imp[dfs[[i]]$hiv2 == 0]), 1)
# Ego's HIV & PrEP combined (3 levels: HIV+, PrEP, No PrEP)
dfs[[i]] <- dfs[[i]] %>% mutate(
hp3 = ifelse(hp == "Pos", 1,
ifelse(hp == "PrEP", 2, 0)))
# Partner's imputed HIV & PrEP combined (3 levels: HIV+, PrEP, No PrEP)
dfs[[i]] <- dfs[[i]] %>% mutate(
p_hp3.imp = ifelse(p_hiv.imp == 1, 1,
ifelse(prep.imp == 0, 0, 2)))
# Imputed HIV and PrEP prevalence among partners
reclass[[i]]$p_hp3.imp.n <- table(dfs[[i]]$p_hp3.imp)
reclass[[i]]$p_hp3.imp.p <- prop.table(table(dfs[[i]]$p_hp3.imp),1)
# Full mixing (HIV+, NP, PrEP) with imputed values
reclass[[i]]$full.sort.n <- table(dfs[[i]]$hp3, dfs[[i]]$p_hp3.imp)
reclass[[i]]$full.sort.p <- prop.table(table(dfs[[i]]$hp3, dfs[[i]]$p_hp3.imp),1)
### Variables for results of reclassification
#pi.hiv
reclass[[i]]$pi.hiv <- median(dfs[[i]]$star1.hiv)
#pi.prep
reclass[[i]]$pi.prep <- median(dfs[[i]]$star1.prep, na.rm = TRUE)
}
# Summary data for each dataset
reclass <- vector("list", 300)
dfs2 <- vector("list", 300)
for (i in seq_along(1:300)) {
### HIV reclassification ----
# P(y*=1) for HIV
reclass[[i]]$star1.hiv.total <- mean(dfs[[i]]$star1.hiv)
reclass[[i]]$star1.hiv.age <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$star1.hiv.race <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$star1.hiv.er <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$star1.hiv.ptype <- by(dfs[[i]]$star1.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$star1.hiv.main <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$star1.hiv.casual <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$star1.hiv.once <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Sens(x,r) for HIV
reclass[[i]]$sens.hiv.total <- mean(dfs[[i]]$sens.xr.hiv)
reclass[[i]]$sens.hiv.age <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$sens.hiv.race <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$sens.hiv.er <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$sens.hiv.ptype <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$sens.hiv.main <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$sens.hiv.casual <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$sens.hiv.once <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Spec(x,r) for HIV
reclass[[i]]$spec.hiv.total <- mean(dfs[[i]]$spec.xr.hiv)
reclass[[i]]$spec.hiv.age <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$spec.hiv.race <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$spec.hiv.er <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$spec.hiv.ptype <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$spec.hiv.main <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$spec.hiv.casual <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$spec.hiv.once <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# P(y=1) for HIV
reclass[[i]]$pred.hiv.total <- mean(dfs[[i]]$pred.hiv)
reclass[[i]]$pred.hiv.age <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$pred.hiv.race <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$pred.hiv.er <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$pred.hiv.ptype <- by(dfs[[i]]$pred.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$pred.hiv.main <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$pred.hiv.casual <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$pred.hiv.once <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Prevalence of imputed HIV
reclass[[i]]$imp.hiv.total <- mean(dfs[[i]]$p_hiv.imp)
reclass[[i]]$imp.hiv.age <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$imp.hiv.race <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$imp.hiv.er <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_hiv, mean)
reclass[[i]]$imp.hiv.ptype <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$ptype, mean)
reclass[[i]]$imp.hiv.main <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$imp.hiv.casual <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$imp.hiv.once <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
### PrEP reclassification ----
# Subset of alters imputed without diagnosed HIV
dfs2[[i]] <- dfs[[i]] %>% filter(p_hiv.imp == 0)
# P(y*=1) for PrEP
reclass[[i]]$star1.prep.total <- mean(dfs2[[i]]$star1.prep)
reclass[[i]]$star1.prep.age <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$star1.prep.race <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$star1.prep.er <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$star1.prep.ptype <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$star1.prep.main <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$star1.prep.casual <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$star1.prep.once <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# Sens(x,r) for PrEP
reclass[[i]]$sens.prep.total <- mean(dfs2[[i]]$sens.xr.prep)
reclass[[i]]$sens.prep.age <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$sens.prep.race <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$sens.prep.er <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$sens.prep.ptype <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$sens.prep.main <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$sens.prep.casual <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$sens.prep.once <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# Spec(x,r) for PrEP
reclass[[i]]$spec.prep.total <- mean(dfs2[[i]]$spec.xr.prep)
reclass[[i]]$spec.prep.age <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$spec.prep.race <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$spec.prep.er <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$spec.prep.ptype <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$spec.prep.main <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$spec.prep.casual <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$spec.prep.once <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# P(y=1) for PrEP
reclass[[i]]$pred.prep.total <- mean(dfs2[[i]]$pred.prep)
reclass[[i]]$pred.prep.age <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$pred.prep.race <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$pred.prep.er <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$pred.prep.ptype <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$pred.prep.main <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$pred.prep.casual <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$pred.prep.once <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# Prevalence of imputed PrEP
reclass[[i]]$imp.prep.total <- mean(dfs2[[i]]$prep.imp)
reclass[[i]]$imp.prep.age <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$imp.prep.race <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$imp.prep.er <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$imp.prep.ptype <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$ptype, mean)
reclass[[i]]$imp.prep.main <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$imp.prep.casual <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$imp.prep.once <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
}
listVec <- lapply(reclass, c, recursive=TRUE)
reclass.results <- as.data.frame(do.call(rbind, listVec))
results <- function(dat, x) {
q <- select(dat, starts_with(x))
#return(t(apply(q, 2, quantile, probs = c(0.025, 0.5, 0.975), na.rm = FALSE)))
#return(t(apply(q, 2, quantile, probs = c(0, 0.5, 1), na.rm = FALSE)))
return(t(apply(q, 2, median, na.rm = FALSE)))
}
results(dat = reclass.results, x = "star1.prep")
results(dat = reclass.results, x = "sens.prep")
results <- function(dat, x) {
q <- select(dat, starts_with(x))
return(t(apply(q, 2, quantile, probs = c(0.025, 0.5, 0.975), na.rm = FALSE)))
#return(t(apply(q, 2, quantile, probs = c(0, 0.5, 1), na.rm = FALSE)))
#return(t(apply(q, 2, median, na.rm = FALSE)))
}
results(dat = reclass.results, x = "sens.prep")
results(dat = reclass.results, x = "spec.prep")
results(dat = reclass.results, x = "pred.prep")
View(dfs2)
View(dfs2[[1]])
results(dat = reclass.results, x = "pred.prep")
mean(dfs2[[1]]$pred.prep)
by(dfs2[[1]]$pred.prep, dfs2[[1]]$p_age.cat_imp, mean)
by(dfs2[[1]]$pred.prep, dfs2[[1]]$prep.during.part2, mean)
by(dfs2[[1]]$pred.prep, dfs2[[1]]$ptype, mean)
by(dfs2[[1]]$pred.prep[dfs2[[1]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[1]]$ptype == "Main"], mean)
by(dfs2[[1]]$pred.prep[dfs2[[1]]$ptype == "Main"], dfs2[[1]]$prep.during.part2[dfs2[[1]]$ptype == "Main"], mean)
by(dfs2[[1]]$pred.prep, dfs2[[1]]$p_race.cat, mean)
by(dfs2[[1]]$pred.prep[dfs2[[1]]$ptype == "Casual"], dfs2[[1]]$prep.during.part2[dfs2[[1]]$ptype == "Casual"], mean)
by(dfs2[[1]]$pred.prep[dfs2[[1]]$ptype == "Once"], dfs2[[1]]$prep.during.part2[dfs2[[1]]$ptype == "Once"], mean)
results(dat = reclass.results, x = "pred.prep.total")
results(dat = reclass.results, x = "imp.prep")
View(reclass)
results <- function(dat, x) {
q <- select(dat, starts_with(x))
return(t(apply(q, 2, quantile, probs = c(0.025, 0.5, 0.975), na.rm = TRUE)))
#return(t(apply(q, 2, quantile, probs = c(0, 0.5, 1), na.rm = FALSE)))
#return(t(apply(q, 2, median, na.rm = FALSE)))
}
results(dat = reclass.results, x = "pred.prep")
results <- function(dat, x) {
q <- select(dat, starts_with(x))
return(t(apply(q, 2, quantile, probs = c(0.025, 0.5, 0.975), na.rm = FALSE)))
#return(t(apply(q, 2, quantile, probs = c(0, 0.5, 1), na.rm = FALSE)))
#return(t(apply(q, 2, median, na.rm = FALSE)))
}
results(dat = reclass.results, x = "pred.prep")
results <- function(dat, x) {
q <- select(dat, starts_with(x))
return(t(apply(q, 2, quantile, probs = c(0.025, 0.5, 0.975), na.rm = TRUE)))
#return(t(apply(q, 2, quantile, probs = c(0, 0.5, 1), na.rm = FALSE)))
#return(t(apply(q, 2, median, na.rm = FALSE)))
}
View(dfs2)
results <- function(dat, x) {
q <- select(dat, starts_with(x))
return(t(apply(q, 2, quantile, probs = c(0.025, 0.5, 0.975), na.rm = TRUE)))
#return(t(apply(q, 2, quantile, probs = c(0, 0.5, 1), na.rm = FALSE)))
#return(t(apply(q, 2, median, na.rm = FALSE)))
}
results(dat = reclass.results, x = "pred.prep")
results(dat = reclass.results, x = "imp.prep")
# Summary data for each dataset
reclass <- vector("list", 300)
dfs2 <- vector("list", 300)
for (i in seq_along(1:300)) {
### HIV reclassification ----
# P(y*=1) for HIV
reclass[[i]]$star1.hiv.total <- mean(dfs[[i]]$star1.hiv)
reclass[[i]]$star1.hiv.age <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$star1.hiv.race <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$star1.hiv.er <- by(dfs[[i]]$star1.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$star1.hiv.ptype <- by(dfs[[i]]$star1.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$star1.hiv.main <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$star1.hiv.casual <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$star1.hiv.once <- by(dfs[[i]]$star1.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Sens(x,r) for HIV
reclass[[i]]$sens.hiv.total <- mean(dfs[[i]]$sens.xr.hiv)
reclass[[i]]$sens.hiv.age <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$sens.hiv.race <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$sens.hiv.er <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$sens.hiv.ptype <- by(dfs[[i]]$sens.xr.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$sens.hiv.main <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$sens.hiv.casual <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$sens.hiv.once <- by(dfs[[i]]$sens.xr.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Spec(x,r) for HIV
reclass[[i]]$spec.hiv.total <- mean(dfs[[i]]$spec.xr.hiv)
reclass[[i]]$spec.hiv.age <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$spec.hiv.race <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$spec.hiv.er <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$spec.hiv.ptype <- by(dfs[[i]]$spec.xr.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$spec.hiv.main <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$spec.hiv.casual <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$spec.hiv.once <- by(dfs[[i]]$spec.xr.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# P(y=1) for HIV
reclass[[i]]$pred.hiv.total <- mean(dfs[[i]]$pred.hiv)
reclass[[i]]$pred.hiv.age <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$pred.hiv.race <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$pred.hiv.er <- by(dfs[[i]]$pred.hiv, dfs[[i]]$p_hiv, mean)
reclass[[i]]$pred.hiv.ptype <- by(dfs[[i]]$pred.hiv, dfs[[i]]$ptype, mean)
reclass[[i]]$pred.hiv.main <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$pred.hiv.casual <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$pred.hiv.once <- by(dfs[[i]]$pred.hiv[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
# Prevalence of imputed HIV
reclass[[i]]$imp.hiv.total <- mean(dfs[[i]]$p_hiv.imp)
reclass[[i]]$imp.hiv.age <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_age.cat_imp, mean)
reclass[[i]]$imp.hiv.race <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_race.cat, mean)
reclass[[i]]$imp.hiv.er <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$p_hiv, mean)
reclass[[i]]$imp.hiv.ptype <- by(dfs[[i]]$p_hiv.imp, dfs[[i]]$ptype, mean)
reclass[[i]]$imp.hiv.main <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Main"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Main"], mean)
reclass[[i]]$imp.hiv.casual <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Casual"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Casual"], mean)
reclass[[i]]$imp.hiv.once <- by(dfs[[i]]$p_hiv.imp[dfs[[i]]$ptype == "Once"], dfs[[i]]$p_hiv[dfs[[i]]$ptype == "Once"], mean)
### PrEP reclassification ----
# Subset of alters imputed without diagnosed HIV
dfs2[[i]] <- dfs[[i]] %>% filter(p_hiv.imp == 0)
# P(y*=1) for PrEP
reclass[[i]]$star1.prep.total <- mean(dfs2[[i]]$star1.prep)
reclass[[i]]$star1.prep.age <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$star1.prep.race <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$star1.prep.er <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$star1.prep.ptype <- by(dfs2[[i]]$star1.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$star1.prep.main <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$star1.prep.casual <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$star1.prep.once <- by(dfs2[[i]]$star1.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# Sens(x,r) for PrEP
reclass[[i]]$sens.prep.total <- mean(dfs2[[i]]$sens.xr.prep)
reclass[[i]]$sens.prep.age <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$sens.prep.race <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$sens.prep.er <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$sens.prep.ptype <- by(dfs2[[i]]$sens.xr.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$sens.prep.main <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$sens.prep.casual <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$sens.prep.once <- by(dfs2[[i]]$sens.xr.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# Spec(x,r) for PrEP
reclass[[i]]$spec.prep.total <- mean(dfs2[[i]]$spec.xr.prep)
reclass[[i]]$spec.prep.age <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$p_age.cat_imp, mean)
reclass[[i]]$spec.prep.race <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$p_race.cat, mean)
reclass[[i]]$spec.prep.er <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$prep.during.part2, mean)
reclass[[i]]$spec.prep.ptype <- by(dfs2[[i]]$spec.xr.prep, dfs2[[i]]$ptype, mean)
reclass[[i]]$spec.prep.main <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean)
reclass[[i]]$spec.prep.casual <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean)
reclass[[i]]$spec.prep.once <- by(dfs2[[i]]$spec.xr.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean)
# P(y=1) for PrEP
reclass[[i]]$pred.prep.total <- mean(dfs2[[i]]$pred.prep, na.rm = TRUE)
reclass[[i]]$pred.prep.age <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$p_age.cat_imp, mean, na.rm = TRUE)
reclass[[i]]$pred.prep.race <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$p_race.cat, mean, na.rm = TRUE)
reclass[[i]]$pred.prep.er <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$prep.during.part2, mean, na.rm = TRUE)
reclass[[i]]$pred.prep.ptype <- by(dfs2[[i]]$pred.prep, dfs2[[i]]$ptype, mean, na.rm = TRUE)
reclass[[i]]$pred.prep.main <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean, na.rm = TRUE)
reclass[[i]]$pred.prep.casual <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean, na.rm = TRUE)
reclass[[i]]$pred.prep.once <- by(dfs2[[i]]$pred.prep[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean, na.rm = TRUE)
# Prevalence of imputed PrEP
reclass[[i]]$imp.prep.total <- mean(dfs2[[i]]$prep.imp, na.rm = TRUE)
reclass[[i]]$imp.prep.age <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$p_age.cat_imp, mean, na.rm = TRUE)
reclass[[i]]$imp.prep.race <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$p_race.cat, mean, na.rm = TRUE)
reclass[[i]]$imp.prep.er <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$prep.during.part2, mean, na.rm = TRUE)
reclass[[i]]$imp.prep.ptype <- by(dfs2[[i]]$prep.imp, dfs2[[i]]$ptype, mean, na.rm = TRUE)
reclass[[i]]$imp.prep.main <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Main"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Main"], mean, na.rm = TRUE)
reclass[[i]]$imp.prep.casual <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Casual"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Casual"], mean, na.rm = TRUE)
reclass[[i]]$imp.prep.once <- by(dfs2[[i]]$prep.imp[dfs2[[i]]$ptype == "Once"], dfs2[[i]]$prep.during.part2[dfs2[[i]]$ptype == "Once"], mean, na.rm = TRUE)
}
listVec <- lapply(reclass, c, recursive=TRUE)
reclass.results <- as.data.frame(do.call(rbind, listVec))
results <- function(dat, x) {
q <- select(dat, starts_with(x))
return(t(apply(q, 2, quantile, probs = c(0.025, 0.5, 0.975), na.rm = FALSE)))
#return(t(apply(q, 2, quantile, probs = c(0, 0.5, 1), na.rm = FALSE)))
#return(t(apply(q, 2, median, na.rm = FALSE)))
}
results(dat = reclass.results, x = "pred.prep")
results(dat = reclass.results, x = "imp.prep")
