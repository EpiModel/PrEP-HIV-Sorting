summary(artnetSort2$p_hiv2.star1)
p_hiv2.pred.star[[1]]$latent[p_hiv2.pred.star[[1]]$latent > 0] <- -0.001
# P(hiv2* = 1)
n.alters <- nrow(artnetSort1)
artnetSort2 <- artnetSort1
artnetSort2$p_hiv2.star1 <- NA
artnetSort2$p_hiv2.star1 <- exp(p_hiv2.pred.star[[1]]$latent[1:n.alters])
## P(hiv2* = 0)
artnetSort2$p_hiv2.star0 <- NA
artnetSort2$p_hiv2.star0 <- 1 - artnetSort2$p_hiv2.star1
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
# Arbitrarily picking values for proof of concept
artnetSort2$q.sens[artnetSort2$ptype == "Main"] <- log(0.98/(1-0.98))
artnetSort2$q.spec[artnetSort2$ptype == "Main"] <- log(0.999/(1-0.999))
artnetSort2$q.sens[artnetSort2$ptype == "Casual"] <- log(0.8/(1-0.8))
artnetSort2$q.spec[artnetSort2$ptype == "Casual"] <- log(0.99/(1-0.99))
artnetSort2$q.sens[artnetSort2$ptype == "Once"] <- log(sens/(1-sens))
artnetSort2$q.spec[artnetSort2$ptype == "Once"] <- log(spec/(1-spec))
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
summary(artnetSort2$p_hiv2.pred)
library(haven)
library("tidyverse")
status <- read_sas("MAN_Data/status.sas7bdat")
participants_survey <- read_sas("MAN_Data/participants_survey.sas7bdat")
partners_survey <- read_sas("MAN_Data/partners_survey.sas7bdat")
HIV.self_report <- participants_survey %>% select(final_id, HIVtest_ever, HIVtest_result)
demo.self_report <- status %>% select(final_id, part_hispanic, starts_with("part_race"), age_baseline)
HIV.ego_report <- partners_survey %>%
filter(final_id %in% status$final_id) %>%
select(final_id, enrolled_final_id, age, hispanic, race, morethanonce, main, pasdiscusstopicsn3, discussstatusfs, statusfs, ls_knowstatus, hivstatls)
# Number of alters per ego
N.alters <- HIV.ego_report %>% count(enrolled_final_id)
HIV.ego_report <- left_join(HIV.ego_report, N.alters, by = "enrolled_final_id") %>%
rename(N.alters.per.ego = n)
### p_hiv
HIV.ego_report$p_hiv <- NA
# only had sex once
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 0 & HIV.ego_report$statusfs == 1] <- 0 # negative
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 0 & HIV.ego_report$statusfs == 2] <- 1 # positive
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 0 & HIV.ego_report$discussstatusfs == 0] <- 2 # didn't discuss
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 0 & HIV.ego_report$discussstatusfs == 1 & HIV.ego_report$statusfs == 9] <- 2 # discussed but don't know status
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 0 & HIV.ego_report$discussstatusfs == 9] <- 2 # don't know if discussed
# sex more than once
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 1 & HIV.ego_report$hivstatls == 1] <- 0 # negative
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 1 & HIV.ego_report$hivstatls == 2] <- 1 # positive
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 1 & HIV.ego_report$ls_knowstatus == 0] <- 2 # don't know
HIV.ego_report$p_hiv[HIV.ego_report$morethanonce == 1 & HIV.ego_report$ls_knowstatus == 9] <- 2 # don't know if status was known
### partner type
HIV.ego_report$ptype <- NA
HIV.ego_report$ptype[HIV.ego_report$main == 1] <- "Main"
HIV.ego_report$ptype[HIV.ego_report$main == 0] <- "Casual"
HIV.ego_report$ptype[HIV.ego_report$main == 9] <- "Casual"
HIV.ego_report$ptype[HIV.ego_report$morethanonce == 0] <- "Once"
HIV.ego_report %>% count(ptype)
# Self-reported HIV for egos
HIV.self_report$hiv3 <- NA
HIV.self_report$hiv3[HIV.self_report$HIVtest_result == 0] <- 0 #negative
HIV.self_report$hiv3[HIV.self_report$HIVtest_result == 1] <- 1 #positive
HIV.self_report$hiv3[HIV.self_report$HIVtest_result %in% c(2, 3)] <- 2
HIV.self_report$hiv3[HIV.self_report$HIVtest_ever == 0] <- 2
hiv3 <- HIV.self_report %>% select(final_id, hiv3) %>% rename(enrolled_final_id = final_id)
p_hiv.validation <- HIV.self_report %>% select(final_id, hiv3) %>% rename(p_hiv.validation = hiv3)
# Merging with the HIV.ego_report
MAN.long <- left_join(HIV.ego_report, hiv3, by = "enrolled_final_id")
MAN.long <- left_join(MAN.long, p_hiv.validation, by = "final_id")
# p_hiv.match: 1 = correct report; 0 = incorrect
MAN.long$p_hiv.match <- NA
MAN.long$p_hiv.match[MAN.long$p_hiv %in% c(0,2) & MAN.long$p_hiv.validation %in% c(0,2)] <- 1
MAN.long$p_hiv.match[MAN.long$p_hiv == 1 & MAN.long$p_hiv.validation == 1] <- 1
MAN.long$p_hiv.match[MAN.long$p_hiv == 1 & MAN.long$p_hiv.validation %in% c(0,2)] <- 0
MAN.long$p_hiv.match[MAN.long$p_hiv %in% c(0,2) & MAN.long$p_hiv.validation == 1] <- 0
table(MAN.long$p_hiv, MAN.long$p_hiv.validation, useNA = "ifany")
table(MAN.long$p_hiv, MAN.long$p_hiv.validation, MAN.long$ptype)
table(MAN.long$p_hiv, MAN.long$p_hiv.match)
table(MAN.long$p_hiv, MAN.long$p_hiv.validation, useNA = "ifany")
table(MAN.long$p_hiv, MAN.long$p_hiv.match)
table(MAN.long$p_hiv, MAN.long$p_hiv.validation, useNA = "ifany")
table(MAN.long$p_hiv, MAN.long$p_hiv.validation, MAN.long$ptype)
# By HIV3
table(MAN.long$p_hiv, MAN.long$p_hiv.validation, MAN.long$hiv3)
# Specificity based on reported as unknown or negative
table(MAN.long$p_hiv, MAN.long$p_hiv.validation)
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
# Arbitrarily picking values for proof of concept
artnetSort2$q.sens[artnetSort2$ptype == "Main"] <- log(0.98/(1-0.98))
artnetSort2$q.spec[artnetSort2$ptype == "Main"] <- log(0.999/(1-0.999))
artnetSort2$q.sens[artnetSort2$ptype == "Casual"] <- log(0.8/(1-0.8))
artnetSort2$q.spec[artnetSort2$ptype == "Casual"] <- log(0.99/(1-0.99))
# Nondifferential
sens.nd <- 24/37   #0.649
spec.nd <- 144/146 #0.986
sens.main <- 13/18 #0.722
spec.main <- 74/75 #0.987
sens.casu <- 5/8   #0.625
spec.casu <- 24/24 #1.0
sens.once <- 6/10  #0.6
spec.once <- 40/41 #0.976
sens.neg <- 2/9     #0.222
spec.neg <- 126/126 #1.0
sens.pos <- 21/26   #0.808
spec.pos <- 11/12   #0.917
sens.unk <- 1/1     #1.0
spec.unk <- 7/7     #1.0
# Arbitrarily picking values for ptype
artnetSort2$q.sens[artnetSort2$ptype == "Main"] <- log(0.98/(1-0.98))
artnetSort2$q.spec[artnetSort2$ptype == "Main"] <- log(0.999/(1-0.999))
artnetSort2$q.sens[artnetSort2$ptype == "Casual"] <- log(0.8/(1-0.8))
artnetSort2$q.spec[artnetSort2$ptype == "Casual"] <- log(0.99/(1-0.99))
artnetSort2$q.sens[artnetSort2$ptype == "Once"] <- log(sens/(1-sens))
artnetSort2$q.spec[artnetSort2$ptype == "Once"] <- log(spec/(1-spec))
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
?rbinom
artnetSort2$p_hiv.imp <- rbinom(1,1,artnetSort2$p_hiv2.pred)
summary(artnetSort2$p_hiv.imp)
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
summary(artnetSort2$p_hiv.imp)
View(artnetSort2)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NULL
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
View(artnetSort2)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp, useNA = "ifany")
?table
table(artnetSort2$p_hiv.imp)
artnetSort2$q.sens <- log(0.7/(1-0.7))
artnetSort2$q.sens <- log(0.986/(1-0.986))
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
table(artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp, useNA = "ifany")
table(artnetSort2$hiv3, artnetSort2$p_hiv)
table(artnetSort2$hiv3, artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv)
artnetSort2$q.sens <- log(0.75/(1-0.75))
artnetSort2$q.sens <- log(0.986/(1-0.986))
artnetSort2$q.sens <- log(0.7/(1-0.7))
artnetSort2$q.spec <- log(0.986/(1-0.986))
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp, useNA = "ifany")
table(artnetSort2$hiv3, artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
artnetSort2$q.sens <- log(0.8/(1-0.8))
artnetSort2$q.spec <- log(0.986/(1-0.986))
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
artnetSort2$q.sens <- log(0.8/(1-0.8))
artnetSort2$q.spec <- log(0.986/(1-0.986))
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp, useNA = "ifany")
table(artnetSort2$p_hiv.imp)
table(artnetSort2$hiv3, artnetSort2$p_hiv.imp)
artnetSort2$hiv2 <- NA
artnetSort2$hiv2[artnetSort2$hiv3 %in% c(0,2)] <- 0
artnetSort2$hiv2[artnetSort2$hiv3 == 1] <- 1
table(artnetSort2$hiv2, artnetSort2$hiv3)
table(artnetSort2$hiv3)
artnetSort2$hiv2 <- NA
artnetSort2$hiv2[artnetSort2$hiv3 %in% c("Neg","Unk")] <- 0
artnetSort2$hiv2[artnetSort2$hiv3 == "Pos"] <- 1
table(artnetSort2$hiv2, artnetSort2$hiv3)
table(artnetSort2$hiv2, artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
artnetSort2$q.sens <- log(0.9/(1-0.9))
artnetSort2$q.spec <- log(0.986/(1-0.986))
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
table(artnetSort2$hiv2, artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
q.sens.pos <- 0.01
q.spec.pos <- 99
artnetSort2$q.sens.med <- NA
artnetSort2$q.spec.med <- NA
# Median q.sens and q.spec
artnetSort2$q.sens.med <- log(0.9/(1-0.9))
artnetSort2$q.spec.med <- log(0.986/(1-0.986))
artnetSort2$q.sens.med <- NA
artnetSort2$q.spec.med <- NA
artnetSort2$q.sens.med <- log(0.9/(1-0.9))
artnetSort2$q.spec.med <- log(0.986/(1-0.986))
artnetSort2$q.sens.p_hiv <- NA
artnetSort2$q.spec.p_hiv <- NA
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == 1] <- 0.01
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == 1] <- 99
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == 0] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == 0] <- log(0.5/(1-0.5))
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == 2] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == 2] <- log(0.5/(1-0.5))
# q.sens and q.spec values
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
artnetSort2$q.sens <- artnetSort2$q.sens.med - artnetSort2$q.sens.p_hiv
artnetSort2$q.spec <- artnetSort2$q.spec.med - artnetSort2$q.spec.p_hiv
check <- artnetSort2 %>% filter(p_hiv == 1)
# Modified for original p_hiv values
artnetSort2$q.sens.p_hiv <- NA
artnetSort2$q.spec.p_hiv <- NA
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Pos"] <- 0.01
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Pos"] <- 99
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
# q.sens and q.spec values
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
artnetSort2$q.sens <- artnetSort2$q.sens.med - artnetSort2$q.sens.p_hiv
artnetSort2$q.spec <- artnetSort2$q.spec.med - artnetSort2$q.spec.p_hiv
check <- artnetSort2 %>% filter(p_hiv == "Pos")
View(check)
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
check <- artnetSort2 %>% filter(p_hiv == "Pos")
View(check)
artnetSort2$q.spec <- NA
check <- artnetSort2 %>% filter(p_hiv == "Pos")
artnetSort2$q.spec <- artnetSort2$q.spec.med + artnetSort2$q.spec.p_hiv
check <- artnetSort2 %>% filter(p_hiv == "Pos")
check <- artnetSort2 %>% filter(p_hiv == "Pos")
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
# Modified for original p_hiv values
artnetSort2$q.sens.p_hiv <- NA
artnetSort2$q.spec.p_hiv <- NA
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
# varied q.sens and q.spec values
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
artnetSort2$q.sens <- artnetSort2$q.sens.med - artnetSort2$q.sens.p_hiv
artnetSort2$q.spec <- artnetSort2$q.spec.med + artnetSort2$q.spec.p_hiv
# deterministic q.sens and q.spec values
artnetSort2$q.sens[artnetSort2$p_hiv == "Pos"] <- 0.01
artnetSort2$q.spec[artnetSort2$p_hiv == "Pos"] <- 99
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
check <- artnetSort2 %>% filter(is.na(artnetSort2$p_hiv2.pred))
View(check)
#### Long df ----
artnetSort1 <- artnetLong %>%
filter(!is.na(p_race.cat), !is.na(p_hiv)) %>%
select(AMIS_ID, city2, ptype,
hiv3, prep.during.ego2, race.cat, age.cat,
p_hiv, prep.during.part2, p_race.cat, p_age.cat_imp)
# prep: assuming no PrEP for those missing
artnetSort1$prep.during.ego2 <- as.numeric(artnetSort1$prep.during.ego2)
artnetSort1$prep.during.ego2 = artnetSort1$prep.during.ego2 - 1
artnetSort1$prep.during.ego2[artnetSort1$prep.during.ego2 == 2] <- 0
artnetSort1$prep.during.ego2[which(is.na(artnetSort1$prep.during.ego2))] <- 0
# Covariates set to factor
artnetSort1$age.cat = factor(artnetSort1$age.cat)
artnetSort1$race.cat = factor(artnetSort1$race.cat)
# p_hiv: 2 level (0 == neg or unk; 1 == pos)
artnetSort1$p_hiv2 <- artnetSort1$p_hiv
artnetSort1$p_hiv2 <- as.numeric(artnetSort1$p_hiv2)
artnetSort1$p_hiv2 = artnetSort1$p_hiv2 - 1
artnetSort1$p_hiv2[artnetSort1$p_hiv2 == 2] <- 0
# ptype set to factor
artnetSort1$ptype = factor(artnetSort1$ptype,  labels = c("Main", "Casual", "Once"))
p_hiv2.inla <- inla(p_hiv2 ~ p_race.cat + p_age.cat_imp + p_race.cat:p_age.cat_imp +
age.cat + race.cat + age.cat:race.cat +
ptype + hiv3 + prep.during.ego2 +
ptype:hiv3 + ptype:prep.during.ego2 +
city2 + f(AMIS_ID, model = "iid"),
data = artnetSort1, family = "binomial",
control.predictor = list(link = 1, compute = TRUE),
control.compute = list(config = TRUE))
# Drawing predictive values from posterior distribution
n.imp <- 1
p_hiv2.pred.star <- inla.posterior.sample(n.imp, p_hiv2.inla)
p_hiv2.pred.star[[1]]$latent[p_hiv2.pred.star[[1]]$latent > 0] <- -0.001
# P(hiv2* = 1)
n.alters <- nrow(artnetSort1)
artnetSort2 <- artnetSort1
artnetSort2$p_hiv2.star1 <- NA
artnetSort2$p_hiv2.star1 <- exp(p_hiv2.pred.star[[1]]$latent[1:n.alters])
## P(hiv2* = 0)
artnetSort2$p_hiv2.star0 <- NA
artnetSort2$p_hiv2.star0 <- 1 - artnetSort2$p_hiv2.star1
# Median q.sens and q.spec
artnetSort2$q.sens.med <- NA
artnetSort2$q.spec.med <- NA
artnetSort2$q.sens.med <- log(0.9/(1-0.9))
artnetSort2$q.spec.med <- log(0.986/(1-0.986))
# Modified for original p_hiv values
artnetSort2$q.sens.p_hiv <- NA
artnetSort2$q.spec.p_hiv <- NA
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
# varied q.sens and q.spec values
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
artnetSort2$q.sens <- artnetSort2$q.sens.med - artnetSort2$q.sens.p_hiv
artnetSort2$q.spec <- artnetSort2$q.spec.med + artnetSort2$q.spec.p_hiv
# deterministic q.sens and q.spec values
artnetSort2$q.sens[artnetSort2$p_hiv == "Pos"] <- 0.01
artnetSort2$q.spec[artnetSort2$p_hiv == "Pos"] <- 99
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv.imp)
check <- artnetSort2 %>% filter(is.na(artnetSort2$p_hiv2.pred))
View(check)
check <- artnetSort2 %>% filter(artnetSort2$p_hiv == 1))
check <- artnetSort2 %>% filter(artnetSort2$p_hiv == 1)
check <- artnetSort2 %>% filter(artnetSort2$p_hiv == "Pos")
View(check)
# deterministic q.sens and q.spec values
artnetSort2$q.sens[artnetSort2$p_hiv == "Pos"] <- log(0.9/(1-0.9))
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
check <- artnetSort2 %>% filter(artnetSort2$p_hiv == "Pos")
View(check)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
# deterministic q.sens and q.spec values
artnetSort2$q.sens[artnetSort2$p_hiv == "Pos"] <- 0.01
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
table(artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
log(0.001/(1-0.001))
0.001/(1-0.001)
99/(1-99)
0.999/(1-0.999)
# Modified for original p_hiv values
artnetSort2$q.sens.p_hiv <- NA
artnetSort2$q.spec.p_hiv <- NA
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Pos"] <- log(0.5/(1-0.5))
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
# varied q.sens and q.spec values
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
artnetSort2$q.sens <- artnetSort2$q.sens.med - artnetSort2$q.sens.p_hiv
artnetSort2$q.spec <- artnetSort2$q.spec.med + artnetSort2$q.spec.p_hiv
# deterministic q.sens and q.spec values
artnetSort2$q.spec[artnetSort2$p_hiv == "Pos"] <- 99
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
table(artnetSort2$p_hiv.imp)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
summary(artnetSort2$p_hiv2.pred, artnetSort2$p_hiv)
?summary
check <- artnetSort2 %>% filter(artnetSort2$p_hiv == "Pos")
summary(check$p_hiv2.pred)
summary(check$p_hiv2.star1)
log(0.5/(1-0.5))
log(0.9/(1-0.9))
log(0.1/(1-0.1))
log(0.8/(1-0.8))
log(0.01/(1-0.01))
log(0.986/(1-0.986))
# Median q.sens and q.spec
artnetSort2$q.sens.med <- NA
artnetSort2$q.spec.med <- NA
artnetSort2$q.sens.med <- log(0.9/(1-0.9))
artnetSort2$q.spec.med <- log(0.986/(1-0.986))
# Modified for original p_hiv values
artnetSort2$q.sens.p_hiv <- NA
artnetSort2$q.spec.p_hiv <- NA
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Pos"] <- log(0.9/(1-0.9))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Pos"] <- 99
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Neg"] <- log(0.5/(1-0.5))
artnetSort2$q.sens.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
artnetSort2$q.spec.p_hiv[artnetSort2$p_hiv == "Unk"] <- log(0.5/(1-0.5))
# varied q.sens and q.spec values
artnetSort2$q.sens <- NA
artnetSort2$q.spec <- NA
artnetSort2$q.sens <- artnetSort2$q.sens.med - artnetSort2$q.sens.p_hiv
artnetSort2$q.spec <- artnetSort2$q.spec.med + artnetSort2$q.spec.p_hiv
# P(Y*=y*|Y,X,R=0)
artnetSort2$sens.xr <- NA
artnetSort2$spec.xr <- NA
artnetSort2$sens.xr <- (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)) / (artnetSort2$p_hiv2.star0 + (artnetSort2$p_hiv2.star1 * exp(artnetSort2$q.sens)))
artnetSort2$spec.xr <- (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)) / (artnetSort2$p_hiv2.star1 + (artnetSort2$p_hiv2.star0 * exp(artnetSort2$q.spec)))
# P(Y=1|X,R=0)
artnetSort2$p_hiv2.pred <- (artnetSort2$p_hiv2.star1 + artnetSort2$spec.xr - 1) / (artnetSort2$sens.xr + artnetSort2$spec.xr - 1)
# p_hiv: imputed
artnetSort2$p_hiv.imp <- NA
artnetSort2$p_hiv.imp <- rbinom(nrow(artnetSort2),1,artnetSort2$p_hiv2.pred)
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
check <- artnetSort2 %>% filter(artnetSort2$prep.during.part2 == 1)
check <- artnetSort2 %>% filter(artnetSort2$prep.during.part2 == "Yes")
table(artnetSort2$p_hiv, artnetSort2$p_hiv.imp)
table(artnetSort2$hiv2, artnetSort2$p_hiv.imp)
artnetSort2$hiv2 <- NA
artnetSort2$hiv2[artnetSort2$hiv3 %in% c("Neg","Unk")] <- 0
artnetSort2$hiv2[artnetSort2$hiv3 == "Pos"] <- 1
table(artnetSort2$hiv2, artnetSort2$p_hiv.imp)
